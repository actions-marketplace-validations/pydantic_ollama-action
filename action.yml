name: Run ollama server
description: Run an ollama server with the model you provide

inputs:
  model:
    description: The model to run

runs:
  using: composite
  steps:
    - name: Cache Ollama Install
      id: cache-ollama
      uses: actions/cache@v4
      with:
        path: ./ollama-run
        key: ollama-${{ hashFiles('install-ollama.sh') }}

    - name: Install Ollama
      if: steps.cache-ollama.outputs.cache-hit != 'true'
      run: ./install-ollama.sh
      shell: bash

    - name: Add ollama to path
      run: echo $(pwd)/ollama-run/bin >> $GITHUB_PATH
      shell: bash

    - name: Start Ollama
      run: ollama start &
      shell: bash

    - name: Ollama Version
      run: ollama --version
      shell: bash

    - name: Pull Model
      run: ollama pull ${{ inputs.model }}
      shell: bash

#  post:
#    - name: Stop Ollama
#      run: echo "Stopping Ollama" && pkill ollama
#      shell: bash
